# SDD (Spec-Driven Development) 運用ルール

## 基本原則

1. **仕様先行**: コードを書く前に、必ず `docs/` ディレクトリ内の仕様書を確認・更新する
2. **ドキュメント同期**: コード変更時は、関連する仕様書も同時に更新する
3. **段階的実装**: `docs/20_PLAN/roadmap.md` に従って段階的に実装を進める

## ディレクトリ構成

```
docs/
├── 00_CONTEXT/        # コンテキスト・背景情報
│   ├── product-goal.md      # プロジェクトの目的とMVP要件
│   └── system-design.md     # アーキテクチャと技術スタック
├── 10_SPEC/           # 仕様定義
│   ├── data-model.md        # データ構造定義
│   └── api-definition.md    # API/CLIインターフェース定義
└── 20_PLAN/           # 実装計画
    └── roadmap.md           # 実装ロードマップ
```

## 開発フロー

### 新機能追加時
1. `docs/10_SPEC/` に仕様を追加・更新
2. `docs/00_CONTEXT/system-design.md` を必要に応じて更新
3. 実装を開始
4. 実装完了後、仕様と実装の整合性を確認

### バグ修正時
1. 該当する仕様書を確認
2. 仕様書が不十分な場合は更新
3. バグ修正を実装
4. 仕様書に反映（必要に応じて）

### リファクタリング時
1. `docs/00_CONTEXT/system-design.md` を更新
2. 実装を変更
3. 仕様書との整合性を確認

## コーディング規約

### Python
- Python 3.10+ の機能を積極的に使用
- 型ヒントを必須とする
- docstringはGoogle形式を使用

### ファイル構成
- `src/` ディレクトリに実装コードを配置
- モジュールは単一責任の原則に従う
- テストは `tests/` ディレクトリに配置

### エラーハンドリング
- カスタム例外クラスを定義して使用
- エラーメッセージは明確で、ユーザーに分かりやすいものにする
- ログは適切なレベルで出力

## コミットメッセージ規約

```
[Phase X] 簡潔な説明

詳細な説明（必要に応じて）

関連する仕様書: docs/10_SPEC/xxx.md
```

例:
```
[Phase 3] テキスト検出モジュールの実装

comic-text-detectorを使用したテキスト領域検出機能を追加。
読み順ソートアルゴリズムも実装。

関連する仕様書: docs/10_SPEC/api-definition.md
```

## チェックリスト

実装前に確認:
- [ ] 関連する仕様書を確認した
- [ ] 仕様書に不足がないか確認した
- [ ] 実装計画（roadmap.md）を確認した

実装後に確認:
- [ ] コードが仕様書と一致している
- [ ] エラーハンドリングが適切に実装されている
- [ ] ログ出力が適切に設定されている
- [ ] 一時ファイルのクリーンアップが実装されている

## 注意事項

- **MPS優先**: Apple Silicon環境では必ずMPSを優先的に使用する
- **エラー継続**: 破損画像があっても処理を継続する（`--skip-errors`がデフォルト）
- **リソース管理**: 一時ファイルは必ずクリーンアップする
- **進捗表示**: 長時間処理の場合は進捗バーを表示する

