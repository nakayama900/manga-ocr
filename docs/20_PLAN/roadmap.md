# Roadmap

## MVP完成までのステップ

### Phase 1: プロジェクト基盤構築

#### 1.1 環境セットアップ
- [x] Python 3.10+ の確認
- [x] 仮想環境の作成（オプション、README.mdに手順あり）
- [x] `requirements.txt` の作成
- [x] プロジェクト構造の作成

#### 1.2 依存ライブラリのインストール
- [x] PyTorch (MPS対応版) のインストール
- [x] `manga-ocr` のインストール
- [x] `comic-text-detector` のインストール（vendor/ディレクトリに統合済み）
- [x] その他依存ライブラリのインストール

#### 1.3 基本構造の実装
- [x] `src/utils.py`: デバイス検出、ユーティリティ関数
- [x] `src/cli.py`: CLIエントリーポイントの骨組み
- [x] 基本的なエラーハンドリング

**完了条件**: コマンドラインから `manga-ocr --help` が動作する

---

### Phase 2: 入力処理の実装

#### 2.1 Zip処理モジュール
- [x] `src/processor.py`: Zip展開機能
- [x] 画像ファイルのフィルタリング（`.jpg`, `.jpeg`, `.png`, `.webp`）
- [x] `natsort` による自然順ソート
- [x] 一時ディレクトリの管理

#### 2.2 エラーハンドリング
- [x] 破損Zipファイルの検出
- [x] 画像ファイルが見つからない場合の処理

**完了条件**: Zipファイルを展開して画像リストを取得できる

---

### Phase 3: テキスト検出の実装

#### 3.1 検出モジュール
- [x] `src/detector.py`: `comic-text-detector` のラッパー
- [x] テキスト領域の検出（comic-text-detector統合完了）
- [x] バウンディングボックスの取得
- [x] `comic-text-detector` の実際の統合（vendorディレクトリに追加）

#### 3.2 読み順ソート
- [x] 漫画の読み順アルゴリズムの実装
  - 右上→左下
  - 段組みの考慮（簡易実装）
- [x] 領域のクロップ処理

**完了条件**: 画像からテキスト領域を検出し、読み順でソートできる

---

### Phase 4: OCR処理の実装

#### 4.1 OCRモジュール
- [x] `src/ocr.py`: `manga-ocr` のラッパー
- [x] MPSデバイスの設定
- [x] テキスト認識処理
- [x] 信頼度の取得（デフォルト値、将来拡張可能）

#### 4.2 パイプライン統合
- [x] 検出→OCRの連携（`src/pipeline.py`）
- [x] エラーハンドリング（skip_errors対応）

**完了条件**: テキスト領域からテキストを認識できる

---

### Phase 5: 出力生成の実装

#### 5.1 出力モジュール
- [x] `src/output.py`: JSON形式の生成
- [x] `src/output.py`: テキスト形式の生成
- [x] 出力ディレクトリの指定

#### 5.2 フォーマット仕様の実装
- [x] JSONスキーマの実装
- [x] テキストフォーマットの実装

**完了条件**: 指定された形式で出力ファイルを生成できる

---

### Phase 6: CLI統合と完成

#### 6.1 CLI完成
- [x] `src/cli.py`: 全オプションの実装
- [x] 引数解析の完成
- [x] エラーメッセージの整備

#### 6.2 進捗表示とログ
- [x] `tqdm` による進捗表示
- [x] ログレベルの設定
- [x] エラーログの出力

#### 6.3 クリーンアップ
- [x] 一時ファイルの削除（processor.pyで実装済み）
- [x] リソースの解放

**完了条件**: エンドツーエンドで動作するCLIツール

---

### Phase 7: テストとドキュメント

#### 7.1 テスト
- [x] ユニットテストの作成
- [x] 統合テストの作成
- [x] サンプルデータでの動作確認（実際のZipファイルで確認済み）

#### 7.2 ドキュメント
- [x] `README.md` の作成・更新
- [x] 使用例の追加
- [x] トラブルシューティングガイド

**完了条件**: テストが通る、ドキュメントが完成している

---

## 実装優先順位

1. **最優先**: Phase 1-2（基盤と入力処理）
2. **高優先**: Phase 3-4（検出とOCR）
3. **中優先**: Phase 5（出力生成）
4. **標準**: Phase 6（CLI統合）
5. **低優先**: Phase 7（テストとドキュメント）

## 想定工数（目安）

- Phase 1: 2-3時間
- Phase 2: 2-3時間
- Phase 3: 4-6時間
- Phase 4: 3-4時間
- Phase 5: 2-3時間
- Phase 6: 2-3時間
- Phase 7: 3-4時間

**合計**: 約18-26時間（個人開発の場合）

## リスクと対策

### リスク1: MPSの互換性問題
- **対策**: 早期にMPS動作確認、CPUフォールバックを実装

### リスク2: 読み順アルゴリズムの精度
- **対策**: サンプルデータで検証、必要に応じて調整

### リスク3: メモリ不足（大きなZipファイル）
- **対策**: ストリーミング処理、バッチサイズの調整

### リスク4: 依存ライブラリのバージョン互換性
- **対策**: `requirements.txt`でバージョン固定、早期に動作確認

